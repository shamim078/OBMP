@{
    ViewBag.Title = "Order Management";
}

<ul id="myTab" class="nav nav-tabs">
    <li><a href="~/Order/Create" class="btn-large">Create Order</a></li>
    <li  class="active"><a href="~/Order/Manage"  class="btn-large">Manage Order</a></li>
</ul>


@(Html.Kendo().Grid<OBMP.Models.OrderList>().Name("Order").Columns(c => {
    c.Bound(o => o.OrderID);
    c.Bound(o => o.Customer);
    c.Bound(o => o.OrderDate).Format("{0:d}"); ;
    c.Bound(o => o.DueDate).Format("{0:d}"); 
    c.Bound(o => o.SalesRep); 
    c.Bound(o => o.Status);
    c.Command(command => command.Custom("Details").Click("showDetails"));
    c.Command(command => command.Custom("History").Click("showHistory"));
    })
    .DataSource(d => d
        .Ajax()
        .Read(r => r.Action("GetActivePendingOrders", "Order"))
        .PageSize(20)
        .ServerOperation(true)
    )
    .Pageable()
    .Groupable()
    .Sortable()
    .Filterable()
)


@(Html.Kendo().Window().Name("Details")
    .Title("Order Details")
    .Visible(false)
    .Modal(true)
    .Content("loading data...")
    .Draggable(true)
    .Width(550)
           
)


@(Html.Kendo().Window().Name("Event")
    .Title("Order Event")
    .Visible(false)
    .Modal(true)
    .Content("loading data...")
    .Draggable(true)
    .Width(550)
           
)


@section Scripts {
    

<script>
    
    function showDetails(e) {
        e.preventDefault();

        var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        var wnd = $("#Details").data("kendoWindow");
        wnd.refresh({
            url: "/Order/OrderDetail",
            data: {OrderID: dataItem.OrderID }
        });

        wnd.center().open();
        
    }

    function showHistory(e) {
        e.preventDefault();

        var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        var wnd = $("#Event").data("kendoWindow");
        wnd.refresh({
            url: "/Order/OrderEvent",
            data: { OrderID: dataItem.OrderID }
        });

        wnd.center().open();

    }

</script>


}